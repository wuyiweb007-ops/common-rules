# 第一印象分析助手（Agent SPEC）

> 本文档定义 **Web Agent 形态** 的 MVP 规格，用于快速验证商业可行性。 本产品以「一次性分析任务 Agent」为核心，而非传统 App。

---

## 1. 产品形态定义

### 1.1 产品形态

* 产品类型：**Single-task AI Agent**
* 交互方式：Web（无需下载）
* 使用模式：上传 → 分析 → 输出 → 结束

### 1.2 核心价值

> 在指定场景下，分析一张照片可能带来的**第一印象**，并给出**可执行的优化建议**。

---

## 2. Agent 设计原则（最高优先级）

1. **一次任务，一次结果**（无对话记忆）
2. 只基于当前输入进行推理
3. 不积累用户画像
4. 不进行身份、人脸或性格识别
5. 输出必须服务于“行动改进”

---

## 3. 使用场景（Scene）

```json
scene = [
  "job_interview",      // 求职 / 面试
  "dating",             // 相亲 / 交友
  "business_profile"    // 商务 / 个人IP
]
```

场景作用：

* 决定 Agent 的分析视角
* 决定输出维度与措辞
* 决定风险提示重点

---

## 4. 用户流程（Agent Flow）

### 4.1 基础分析流程
1. 用户进入 Web 页面（wiseflow.com）
2. 选择分析场景
3. 上传照片（1 张，≤5MB）
4. 前置校验：人脸检测（自动识别最大人脸）
5. Agent 执行分析（3–6 秒，不含上传时间，展示进度）
6. 返回结构化结果（免费版：摘要 + 部分建议）
7. 用户选择是否解锁完整分析

### 4.2 付费解锁流程
1. 点击"解锁完整分析"
2. 弹出个人微信收款码
3. 用户扫码转账后点击"已支付"
4. 立即展示完整结果

### 4.3 对比分析流程
1. 选择场景（两张照片必须使用同一场景）
2. 上传照片 A + 照片 B
3. 执行对比分析（¥19.9）
4. 输出：更优照片 + 判断依据 + 使用建议

### 4.4 分享流程
1. 用户点击"分享结果"
2. 生成唯一链接（含完整分析内容）
3. 分享页展示结果 + "返回首页体验"按钮

---

## 5. Agent 内部模块拆解

### 5.1 输入校验模块

#### 图片校验规则
* 格式：JPG / PNG / HEIC / WebP
* 大小：≤5MB
* 人脸检测：必须通过前置校验（自动识别最大人脸）

#### 拒绝场景
* 无人脸
* 多人且无法识别主体
* 照片过暗 / 过曝
* 场景参数非法

#### 降级提示
* 无法判断表情等部分特征时，提示用户重新上传

---

### 5.2 外观信号提取模块（Image Signal Extractor）

**只输出描述性特征，不输出任何身份信息**：

* 清晰度：clear / normal / blurry
* 光照：front / side / back
* 表情状态：neutral / smile / tense
* 构图：centered / offset / cropped
* 背景复杂度：simple / normal / cluttered

---

### 5.3 Prompt 构建模块（Prompt Builder）

职责：

* 注入场景上下文
* 注入外观信号描述
* 注入合规与语言约束

核心规则：

* 只允许“第一印象”级别判断
* 必须使用概率/倾向描述
* 禁止性格、命运、能力推断

---

### 5.4 推理模块（LLM Reasoner）

* 接收结构化 Prompt
* 不保留历史上下文
* 模型可替换、可降级

---

### 5.5 结果解析模块（Result Parser）

#### 输出要求
* LLM 必须返回 JSON 格式
* 格式错误时使用人工兜底文案

#### 统一输出结构
1. 第一印象摘要（≤3 行）
2. 正向信号（3–5 条）
3. 潜在风险（2–4 条）
4. 可执行优化建议（完整版）

#### 免费版展示策略
* 显示：第一印象摘要
* 显示：部分优化建议（2–3 条）
* 隐藏：正向信号、潜在风险、完整建议列表

---

### 5.6 合规护栏模块（Guardrail）

#### 自动检测并拦截
* 断言式人格判断
* 命运 / 运势 / 财运相关表述
* 敏感属性推断

#### 违规处理策略
* 最多重试 3 次
* 3 次后仍违规：拒绝访问并提示用户
* 不记录违规日志

---

## 6. 对比分析 Agent（付费）

### 输入

* Photo A
* Photo B
* Scene

### 输出

* 哪张照片在该场景下更合适
* 判断依据（3 条）
* 使用建议

---

## 7. 技术架构（Web Agent）

### 7.1 前端
* 纯静态 H5 + API 调用
* 适配微信内置浏览器
* 域名：wiseflow.com

### 7.2 后端
* 阿里云 Serverless Function（Agent Runtime）
* API Gateway
* 服务器：阿里云（国内）

### 7.3 AI 服务
* LLM：通义千问 VL（多模态）
* 人脸检测：前置校验（自动识别最大人脸）

### 7.4 存储策略
* 图片：临时对象存储（≤24h 自动删除，硬性要求）
* 结果：不使用缓存，每次上传重新分析
* 分享链接：永久存储（用于分享访问）

### 7.5 错误降级策略
* LLM 服务不可用：弹窗提示 + 客服电话（18655205007）
* 已付费但分析失败：弹窗提示 + 客服电话
* 超时（>6秒）：弹窗提示用户

---

## 8. API 最小集合

### POST /analyze
* 输入：image（base64），scene
* 输出：analysis_id，summary，partial_suggestions
* 超时：6 秒

### POST /unlock
* 输入：analysis_id，payment_confirmed（用户点击"已支付"）
* 输出：完整分析结果（JSON）

### POST /compare
* 输入：image_a，image_b，scene
* 输出：better_photo，reasons（3 条），suggestions
* 付费：¥19.9

### GET /share/:id
* 输入：分享链接 ID
* 输出：完整分析结果（HTML）

---

## 9. 商业与付费设计（验证期）

### 9.1 定价策略
* 基础分析：免费（仅展示摘要 + 部分建议）
* 完整分析：¥9.9（针对单次分析）
* 对比分析：¥19.9（针对单次对比）

### 9.2 支付流程
1. 用户点击"解锁完整分析"
2. 弹出个人微信收款码
3. 用户扫码转账
4. 点击"已支付"按钮
5. 立即展示完整结果

### 9.3 用户身份
* 无需注册 / 登录
* 匿名用户可直接付费
* 无需发票

### 9.4 数据保留策略
* 付费后结果可分享（生成唯一链接）
* 分享链接永久有效
* 用户可点击"删除"按钮（仅心理安慰，无实际逻辑）

---

## 10. 合规声明（必须展示）

> 本产品仅说明照片在特定场景下可能形成的第一印象， 不代表个人真实能力、性格或未来结果，请理性参考。

---

## 11. MVP 成功标准

* 7 天内完成上线
* 真实用户完成付费 ≥3 单
* 无明显合规风险或投诉

## 11.1 发布策略
* 开发测试后直接发布（无灰度 / 内测）
* 部署在阿里云（国内服务器 + Serverless）
* 域名：wiseflow.com（已备案）

---

## 12. 明确不做（边界）

* 不做长期对话 Agent
* 不做用户画像
* 不做人脸识别或身份判断
* 不提供任何算命或预测功能

---

## 13. 验收测试计划

### 13.1 功能测试
- [ ] 图片上传：5MB 边界、格式校验
- [ ] 人脸检测：无人脸拒绝、多人自动识别最大人脸
- [ ] 场景切换：3 种场景正常工作
- [ ] 免费版：仅展示摘要 + 部分建议
- [ ] 付费解锁：弹出收款码 → 点击"已支付" → 展示完整结果
- [ ] 对比分析：两张照片 + 同一场景
- [ ] 分享链接：生成 → 访问 → 展示完整结果 → 返回首页

### 13.2 异常测试
- [ ] 超时（>6秒）：弹窗提示
- [ ] LLM 不可用：弹窗 + 客服电话
- [ ] 人脸检测失败：拒绝分析 + 提示重新上传
- [ ] 合规护栏触发：最多 3 次重试，失败后拒绝访问
- [ ] 格式错误：人工兜底文案

### 13.3 兼容性测试
- [ ] 微信内置浏览器
- [ ] iOS Safari
- [ ] Android Chrome

### 13.4 合规测试
- [ ] 输出不包含人格判断
- [ ] 输出不包含命运 / 运势表述
- [ ] 合规声明正常展示

---

## 14. 未决问题清单

1. **人工兜底文案具体内容**（需产品提供）
2. **微信收款码图片**（需运营提供）
3. **分享页 SEO 优化**（可选，后续迭代）
4. **通义千问 VL API 配额与成本**（需技术确认）

---

**End of Agent SPEC**
